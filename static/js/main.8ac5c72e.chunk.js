(window.webpackJsonpcofi=window.webpackJsonpcofi||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(5),i=n.n(c),o=n(2),s=n(1),u=(n(14),n(8)),l=n(3);function m(e){var t=e.toggleStep,n=e.instId,a=e.timing,c=a.currentStep,i=a.stepCt,o=a.stepInfo,s="".concat(c===i),u="".concat(o.activated),l="".concat(n,"Step").concat(i),m="s-".concat(i);return r.a.createElement("div",{className:"step",triggered:s,activated:u,id:l,key:m,onClick:function(e){t(n,i)}})}function f(e){var t=e.instruments,n=e.toggleStep,a=e.timing,c=a.timeSignature,i=a.currentStep;return r.a.createElement("div",{className:"step-pattern"},function(e){var t=[],a=function(a){var o=e[a],s=[];t.push(r.a.createElement("div",{className:"instrument-container",key:"ic-".concat(a)},r.a.createElement("div",{className:"instrument",key:"i".concat(a)},"".concat(a)),r.a.createElement("div",{className:"pattern",key:"p".concat(a)},o.pattern.map((function(e,t){var o,u="ps".concat(a,"-").concat(t);if(t%c===0&&(s=[]),s.push(r.a.createElement(m,{key:u,toggleStep:n,instId:a,timing:{currentStep:i,stepCt:t,stepInfo:e}})),t%c===c-1)return o=s,r.a.createElement("div",{className:"measure"},o,r.a.createElement("div",{className:"signatureSpacer"}))})))))};for(var o in e)a(o);return t}(t))}function v(e){var t=e.instruments,n=e.setInstruments,a=e.timing,c=(a.globalBPM,a.currentStep),i=a.timeSignature;return r.a.createElement("div",{className:"sequencer"},r.a.createElement(f,{instruments:t,toggleStep:function(e,a){var r=Object(l.a)({},t),c=r[e].pattern[a],i=c.activated,o=Object(u.a)(c,["activated"]);r[e].pattern[a]=Object(l.a)({activated:!i},o),n(r)},timing:{timeSignature:i,currentStep:c}}))}function d(){return r.a.createElement("nav",{className:"header"},r.a.createElement("div",{className:"title"},"Cofi"),r.a.createElement("div",{className:"toggle"},r.a.createElement("div",null,"Visualizer"),r.a.createElement("div",null,"Clear "),r.a.createElement("div",null,"Save")))}var p="128";function g(e){var t=e.bpmObj,n=e.stepObj,a=t.globalBPM,c=t.setGlobalBPM,i=t.inputBPM,o=t.setInputBPM,s=n.currentStep;return r.a.createElement("div",{className:"bpm-container"},r.a.createElement("div",{className:"bpm-control"},r.a.createElement("input",{id:"bpm-input",type:"text",pattern:"[0-9]*",onBlur:function(e){var t=e.target.value;t>50&&t<200?(c(t),o(t)):(c(a),o(a))},onChange:function(e){var t=e.target.validity.valid&&e.target.value.length<=3&&Number(e.target.value)<=200?e.target.value:String(p);o(t)},value:i})),s>=0&&r.a.createElement("div",{className:"beat-count"},"beat count: ",s+1))}function b(e){return r.a.createElement("div",{className:"transport-container"},r.a.createElement("div",{className:"transport"},r.a.createElement("div",{className:"rewind"},"<"),function(){var t=!0!==e.playing?{color:"red"}:{color:"black"},n=!0===e.playing?{color:"red"}:{color:"black"};return r.a.createElement("div",{className:"play-pause",onClick:e.togglePause},r.a.createElement("span",{className:"pause",style:t},"\u04cf\u04cf"),r.a.createElement("span",{className:"play",style:n},"\u25b6"))}(),r.a.createElement("div",{className:"stop"},"\u2591"),r.a.createElement("div",{className:"forward"},">")))}var h=n(6),E=n(7),w=function(){function e(t,n){return Object(h.a)(this,e),this.AC=t,this.freq=n,this.wave="sine",this.createNodes=this.createNodes.bind(this),this.setFreq=this.setFreq.bind(this),this.setWaveform=this.setWaveform.bind(this),this.setBaseValues=this.setBaseValues.bind(this),this.setBaseValues(this.wave,n,t)}return Object(E.a)(e,[{key:"createNodes",value:function(e){return{source:e.createOscillator()}}},{key:"setFreq",value:function(e,t){return e.source.frequency.value=t,e}},{key:"setWaveform",value:function(e,t){if(["sine","square","sawtooth","triangle"].includes(t))e.source.type=t;else if("custom"===t){var n=new Float32Array([0,1]),a=new Float32Array([0,0]),r=AudioContext.createPeriodicWave(n,a,{disableNormalization:!0});e.source.setPeriodicWave(r)}}},{key:"setBaseValues",value:function(e,t,n){var a=this.createNodes(n);return this.setFreq(a,t,n),this.setWaveform(a,e),a}}]),e}();var O=function(e,t,n,a,r,c){return t=function(e,t){var n=e.createGain();return n.gain.value=0,t.gain=n,t}(e,t),console.log("start tiem here and source: ",n,t),function(e,t){e.gain.gain.value=0,e.gain.gain.linearRampToValueAtTime(.8,t+.09)}(t,n),t.gain.gain.linearRampToValueAtTime(0,n+.2),t.source.start(n),t.source.stop(n+a),666!==t.source.frequency.value&&function(e,t){t.gain.connect(e.destination),t.source.connect(t.gain)}(e,t),t.source.onended=r,t},j=function(e,t,n,a,r){for(var c in r){if(r[c].pattern[t].activated){var i=new r[c].source(e,r[c].freq);console.log("my dource",i);r[c].pattern[t].automation;var o=60/a;console.log("in step: start tiem here",n,e.currentTime),O(e,i,n,o/2)}}};var y=new(window.AudioContext||window.webkitAudioContext);var S=function(e,t,n,a){t(-1),n(!1),e.close(),e=new(window.AudioContext||window.webkitAudioContext),a(!1)},N=function(e,t){t(!e)},k=function(e,t,n){n(t+(","!==e||"."===e&&!0===e?1:-1))};function q(e,t,n,a,r,c,i,o){"suspended"===t.state&&!1===n&&(console.log("not initialized yet..."),a(),r(!0)),c(i,o)}!function(){var e="undefined"!==typeof InstallTrigger,t=!!window.chrome&&(!!window.chrome.webstore||!!window.chrome.runtime);if(!e&&!t)throw alert("Please use either Firefox or Chrome"),new Error}();var T=[];Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement((function(){var e=S,t=k,n=N,c=q,i=Object(a.useState)("128"),u=Object(s.a)(i,2),l=u[0],m=u[1],f=Object(a.useState)(l),p=Object(s.a)(f,2),h=p[0],E=p[1],B=Object(a.useState)(-1),P=Object(s.a)(B,2),x=P[0],A=P[1],C=Object(a.useState)(16),I=Object(s.a)(C,2),M=I[0],V=(I[1],Object(a.useState)(4)),W=Object(s.a)(V,2),F=W[0],R=(W[1],Object(a.useState)(function(e,t){var n={triggered:!1,activated:!1,automation:{}},a={kick:{source:w,context:e,freq:261.6},snare:{source:w,context:e,freq:400},hihat_open:{source:w,context:e,freq:350},hihat_closed:{source:w,context:e,freq:300},clap:{source:w,context:e,freq:250},rim:{source:w,context:e,freq:200},bell:{source:w,context:e,freq:180}};for(var r in a)a[r].pattern=new Array(t).fill(n);return a}(y,M))),G=Object(s.a)(R,2),z=G[0],J=G[1],_=Object(a.useState)(!0),D=Object(s.a)(_,2),$=(D[0],D[1],Object(a.useState)(!1)),H=Object(s.a)($,2),K=H[0],L=H[1],Q=Object(a.useState)(!1),U=Object(s.a)(Q,2),X=U[0],Y=U[1],Z=Object(a.useState)(null),ee=Object(s.a)(Z,2),te=ee[0],ne=ee[1],ae=Object(a.useState)([]),re=Object(s.a)(ae,2),ce=re[0],ie=re[1];function oe(){var e=se(!0);e.start(0),e.stop(.05)}function se(e){console.log("making note: time=",y.currentTime);var t=y.createOscillator(),n=y.createGain();return n.gain.value=0,n.gain.linearRampToValueAtTime(.1,y.currentTime+.09),n.gain.linearRampToValueAtTime(0,y.currentTime+.15),t.frequency.value=666,t.connect(n),n.connect(y.destination),!1===e&&y.currentTime>0&&A(x+1),t}return function(e){document.onkeypress=function(t){var n=t.key;document.activeElement===document.body?(t.preventDefault(),e.hasOwnProperty(n)&&e[n](t)):"Escape"===n&&document.activeElement.blur()}}({" ":function(e){return c(e,y,X,oe,Y,n,K,L)},"?":function(){return e(y,A,L,Y)},",":function(){return t(",",x,A)},".":function(){return t(".",x,A)}}),Object(a.useEffect)((function(){0===y.currentTime&&oe()}),[]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){function e(){n.current()}if(null!==t){e();var a=setInterval(e,t);return function(){return clearInterval(a)}}}),[t])}((function(){for(var e=2*te/1e3,t=60/l,n=y.currentTime,a=n+e,r=ce.filter((function(e){return e>n&&e<=a&&!T.includes(e)&&n>.2})),c=0;c<r.length;c++){var i=r[c],s=se(!1);O(y,{source:s},i,t);var u=[].concat(Object(o.a)(T),[i]);u.length>Number(M)&&(u=u.slice(1)),T=u}(ce[ce.length-1]+t<a||y.currentTime>ce[0])&&ie(ce.map((function(e){return e+t})))}),te),Object(a.useEffect)((function(){if(K){var e=y.currentTime,t=Object(o.a)(Array(M-x).keys()).map((function(t){return e+t*(60/l)}));ie(t),"suspended"===y.state&&y.resume(),ne(15)}else"running"===y.state&&y.suspend(),ne(null)}),[K]),Object(a.useEffect)((function(){x>=M&&A(0),x>0&&x<M&&j(y,x,ce[0],l,z)}),[x]),r.a.createElement("div",{className:"App"},r.a.createElement(d,null),r.a.createElement(b,{togglePause:n,playing:K}),r.a.createElement(g,{bpmObj:{globalBPM:l,setGlobalBPM:m,inputBPM:h,setInputBPM:E},stepObj:{totalSteps:M,currentStep:x}}),r.a.createElement(v,{instruments:z,setInstruments:J,timing:{globalBPM:l,currentStep:x,timeSignature:F}}))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},9:function(e,t,n){e.exports=n(15)}},[[9,1,2]]]);
//# sourceMappingURL=main.8ac5c72e.chunk.js.map