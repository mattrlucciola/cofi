(window.webpackJsonpcofi=window.webpackJsonpcofi||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(4),i=n.n(c),o=(n(14),n(2)),s=n(1),u=(n(15),n(8)),l=n(5);function m(e){var t=e.toggleStep,n=e.instId,a=e.timing,c=a.currentStep,i=a.stepCt,o=a.stepInfo,s="".concat(c===i),u="".concat(o.activated),l="".concat(n,"Step").concat(i),m="s-".concat(i);return r.a.createElement("div",{className:"step",triggered:s,activated:u,id:l,key:m,onClick:function(e){t(n,i)}})}function f(e){var t=e.instruments,n=e.toggleStep,a=e.timing,c=a.timeSignature,i=a.currentStep;return r.a.createElement("div",{className:"step-pattern"},function(e){var t=[],a=function(a){var o=e[a],s=[];t.push(r.a.createElement("div",{className:"instrument-container",key:"ic-".concat(a)},r.a.createElement("div",{className:"instrument",key:"i".concat(a)},"".concat(a)),r.a.createElement("div",{className:"pattern",key:"p".concat(a)},o.pattern.map((function(e,t){var o,u="ps".concat(a,"-").concat(t);if(t%c===0&&(s=[]),s.push(r.a.createElement(m,{key:u,toggleStep:n,instId:a,timing:{currentStep:i,stepCt:t,stepInfo:e}})),t%c===c-1)return o=s,r.a.createElement("div",{className:"measure"},o,r.a.createElement("div",{className:"signatureSpacer"}))})))))};for(var o in e)a(o);return t}(t))}function v(){return r.a.createElement("div",{className:"automation"},r.a.createElement("div",{className:"instrument"},r.a.createElement("div",{className:"pattern"},"were in automation mode")))}function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(n,!0).forEach((function(t){Object(l.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){var t=e.instruments,n=e.setInstruments,a=e.toggles,c=e.timing,i=a.handleSequencerToggle,o=a.automationToggle,s=(c.globalBPM,c.currentStep),l=c.timeSignature;return r.a.createElement("div",{className:"sequencer"},r.a.createElement("div",{className:"sequencer-toggle",onClick:i}," ",o?"Pattern":"Automation"),o?r.a.createElement(f,{instruments:t,toggleStep:function(e,a){var r=d({},t),c=r[e].pattern[a],i=c.activated,o=Object(u.a)(c,["activated"]);r[e].pattern[a]=d({activated:!i},o),n(r)},timing:{timeSignature:l,currentStep:s}}):r.a.createElement(v,{instruments:t}))}function b(){return r.a.createElement("nav",{className:"header"},r.a.createElement("div",{className:"title"},"Cofi"),r.a.createElement("div",{className:"toggle"},r.a.createElement("div",null,"Visualizer"),r.a.createElement("div",null,"Clear "),r.a.createElement("div",null,"Save")))}var h="128";function O(e){var t=e.bpmObj,n=e.stepObj,a=t.globalBPM,c=t.setGlobalBPM,i=t.inputBPM,o=t.setInputBPM,s=n.currentStep;return r.a.createElement("div",{className:"bpm-container"},r.a.createElement("div",{className:"bpm-control"},r.a.createElement("input",{id:"bpm-input",type:"text",pattern:"[0-9]*",onBlur:function(e){var t=e.target.value;t>50&&t<200?(c(t),o(t)):(c(a),o(a))},onChange:function(e){var t=e.target.validity.valid&&e.target.value.length<=3&&Number(e.target.value)<=200?e.target.value:String(h);o(t)},value:i})),s>=0&&r.a.createElement("div",{className:"beat-count"},"beat count: ",s+1))}function E(e){return r.a.createElement("div",{className:"transport-container"},r.a.createElement("div",{className:"transport"},r.a.createElement("div",{className:"rewind"},"<"),function(){var t=!0!==e.playing?{color:"red"}:{color:"black"},n=!0===e.playing?{color:"red"}:{color:"black"};return r.a.createElement("div",{className:"play-pause",onClick:e.togglePause},r.a.createElement("span",{className:"pause",style:t},"\u04cf\u04cf"),r.a.createElement("span",{className:"play",style:n},"\u25b6"))}(),r.a.createElement("div",{className:"stop"},"\u2591"),r.a.createElement("div",{className:"forward"},">")))}var j=n(6),y=n(7),w=function(){function e(t,n){return Object(j.a)(this,e),this.AC=t,this.freq=n,this.wave="sine",this.createNodes=this.createNodes.bind(this),this.setFreq=this.setFreq.bind(this),this.setWaveform=this.setWaveform.bind(this),this.setBaseValues=this.setBaseValues.bind(this),this.setBaseValues(this.wave,n,t)}return Object(y.a)(e,[{key:"createNodes",value:function(e){return{source:e.createOscillator()}}},{key:"setFreq",value:function(e,t){return e.source.frequency.value=t,e}},{key:"setWaveform",value:function(e,t){if(["sine","square","sawtooth","triangle"].includes(t))e.source.type=t;else if("custom"===t){var n=new Float32Array([0,1]),a=new Float32Array([0,0]),r=AudioContext.createPeriodicWave(n,a,{disableNormalization:!0});e.source.setPeriodicWave(r)}}},{key:"setBaseValues",value:function(e,t,n){var a=this.createNodes(n);return this.setFreq(a,t,n),this.setWaveform(a,e),a}}]),e}();var S=function(e,t,n,a,r,c){return t=function(e,t){var n=e.createGain();return n.gain.value=0,t.gain=n,t}(e,t),console.log("start tiem here and source: ",n,t),function(e,t){e.gain.gain.value=0,e.gain.gain.linearRampToValueAtTime(.8,t+.09)}(t,n),t.gain.gain.linearRampToValueAtTime(0,n+.2),t.source.start(n),t.source.stop(n+a),666!==t.source.frequency.value&&function(e,t){t.gain.connect(e.destination),t.source.connect(t.gain)}(e,t),t.source.onended=r,t},N=function(e,t,n,a,r){for(var c in r){if(r[c].pattern[t].activated){var i=new r[c].source(e,r[c].freq);console.log("my dource",i);r[c].pattern[t].automation;var o=60/a;console.log("in step: start tiem here",n,e.currentTime),S(e,i,n,o/2)}}},k=[];var P=new(window.AudioContext||window.webkitAudioContext),T=[];var q=function(){var e=Object(a.useState)("128"),t=Object(s.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(n),u=Object(s.a)(i,2),l=u[0],m=u[1],f=Object(a.useState)(-1),v=Object(s.a)(f,2),p=v[0],d=v[1],h=Object(a.useState)(16),j=Object(s.a)(h,2),y=j[0],q=(j[1],Object(a.useState)(4)),B=Object(s.a)(q,2),A=B[0],C=B[1],x=Object(a.useState)(function(e,t){var n={triggered:!1,activated:!1,automation:{}},a={kick:{source:w,context:e,freq:261.6},snare:{source:w,context:e,freq:400},hihat_open:{source:w,context:e,freq:350},hihat_closed:{source:w,context:e,freq:300},clap:{source:w,context:e,freq:250},rim:{source:w,context:e,freq:200},bell:{source:w,context:e,freq:180}};for(var r in a)a[r].pattern=new Array(t).fill(n);return a}(P,y)),I=Object(s.a)(x,2),M=I[0],V=I[1],W=Object(a.useState)(!0),F=Object(s.a)(W,2),D=F[0],R=F[1],G=Object(a.useState)(!1),z=Object(s.a)(G,2),J=z[0],_=z[1],$=Object(a.useState)(!1),H=Object(s.a)($,2),K=H[0],L=H[1],Q=Object(a.useState)(null),U=Object(s.a)(Q,2),X=U[0],Y=U[1],Z=Object(a.useState)([]),ee=Object(s.a)(Z,2),te=ee[0],ne=ee[1];function ae(){R(!D)}document.onkeypress=function(e){var t=e.key;document.activeElement===document.body?(e.preventDefault(),"p"===t&&ae()," "===t&&("suspended"===P.state&&!1===K&&(console.log("not initialized yet..."),oe(),L(!0)),ce(e)),"?"===t&&re(),","!==t&&"."!==t||ie(t)):"Escape"===t&&document.activeElement.blur()};var re=function(){d(-1),_(!1),P.close(),P=new(window.AudioContext||window.webkitAudioContext),L(!1)},ce=function(){_(!J)},ie=function(e){d(p+(","!==e||"."===e&&!0===e?1:-1))};function oe(){var e=se(!0);e.start(0),e.stop(.05)}function se(e){console.log("making note: time=",P.currentTime);var t=P.createOscillator(),n=P.createGain();return n.gain.value=0,n.gain.linearRampToValueAtTime(.1,P.currentTime+.09),n.gain.linearRampToValueAtTime(0,P.currentTime+.15),t.frequency.value=666,t.connect(n),n.connect(P.destination),!1===e&&P.currentTime>0&&d(p+1),t}return Object(a.useEffect)((function(){0===P.currentTime&&oe()}),[]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){function e(){n.current()}if(null!==t){e();var a=setInterval(e,t);return function(){return clearInterval(a)}}}),[t])}((function(){for(var e=2*X/1e3,t=60/n,a=P.currentTime,r=a+e,c=te.filter((function(e){return e>a&&e<=r&&!T.includes(e)&&a>.2})),i=0;i<c.length;i++){var s=c[i],u=se(!1);S(P,{source:u},s,t);var l=[].concat(Object(o.a)(T),[s]);l.length>Number(y)&&(l=l.slice(1)),T=l}(te[te.length-1]+t<r||P.currentTime>te[0])&&ne(te.map((function(e){return e+t})))}),X),Object(a.useEffect)((function(){if(J){var e=P.currentTime,t=Object(o.a)(Array(y-p).keys()).map((function(t){return e+t*(60/n)}));ne(t),"suspended"===P.state&&P.resume(),Y(15)}else"running"===P.state&&P.suspend(),Y(null)}),[J]),Object(a.useEffect)((function(){p>=y&&d(0),p>0&&p<y&&N(P,p,te[0],n,M),function(e,t){e.push(t);var n=0,a=[];e.forEach((function(t,n){if(n>0){var r=e[n+1]-t;a.push(r)}})),a.pop(),a.forEach((function(e){n+=e})),console.log("avg: ".concat(n/a.length),a)}(k,P.currentTime)}),[p]),r.a.createElement("div",{className:"App"},r.a.createElement(b,null),r.a.createElement(E,{togglePause:ce,playing:J}),r.a.createElement(O,{bpmObj:{globalBPM:n,setGlobalBPM:c,inputBPM:l,setInputBPM:m,handleTimeSignatureChange:function(e){C(e)}},stepObj:{totalSteps:y,currentStep:p}}),r.a.createElement(g,{instruments:M,setInstruments:V,timing:{globalBPM:n,currentStep:p,timeSignature:A},toggles:{handleSequencerToggle:ae,automationToggle:D}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(q,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},9:function(e,t,n){e.exports=n(16)}},[[9,1,2]]]);
//# sourceMappingURL=main.a5933222.chunk.js.map