(window.webpackJsonpcofi=window.webpackJsonpcofi||[]).push([[0],{14:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(5),i=n.n(c),o=(n(14),n(2)),s=n(1),u=(n(15),n(8)),l=n(3);function m(e){var t=e.toggleStep,n=e.instId,a=e.timing,c=a.currentStep,i=a.stepCt,o=a.stepInfo,s="".concat(c===i),u="".concat(o.activated),l="".concat(n,"Step").concat(i),m="s-".concat(i);return r.a.createElement("div",{className:"step",triggered:s,activated:u,id:l,key:m,onClick:function(e){t(n,i)}})}function v(e){var t=e.instruments,n=e.toggleStep,a=e.timing,c=a.timeSignature,i=a.currentStep;return r.a.createElement("div",{className:"step-pattern"},function(e){var t=[],a=function(a){var o=e[a],s=[];t.push(r.a.createElement("div",{className:"instrument-container",key:"ic-".concat(a)},r.a.createElement("div",{className:"instrument",key:"i".concat(a)},"".concat(a)),r.a.createElement("div",{className:"pattern",key:"p".concat(a)},o.pattern.map((function(e,t){var o,u="ps".concat(a,"-").concat(t);if(t%c===0&&(s=[]),s.push(r.a.createElement(m,{key:u,toggleStep:n,instId:a,timing:{currentStep:i,stepCt:t,stepInfo:e}})),t%c===c-1)return o=s,r.a.createElement("div",{className:"measure"},o,r.a.createElement("div",{className:"signatureSpacer"}))})))))};for(var o in e)a(o);return t}(t))}function f(){return r.a.createElement("div",{className:"automation"},r.a.createElement("div",{className:"instrument"},r.a.createElement("div",{className:"pattern"},"were in automation mode")))}function d(e){var t=e.instruments,n=e.setInstruments,a=e.toggles,c=e.timing,i=a.handleSequencerToggle,o=a.automationToggle,s=(c.globalBPM,c.currentStep),m=c.timeSignature;return r.a.createElement("div",{className:"sequencer"},r.a.createElement("div",{className:"sequencer-toggle",onClick:i}," ",o?"Pattern":"Automation"),o?r.a.createElement(v,{instruments:t,toggleStep:function(e,a){var r=Object(l.a)({},t),c=r[e].pattern[a],i=c.activated,o=Object(u.a)(c,["activated"]);r[e].pattern[a]=Object(l.a)({activated:!i},o),n(r)},timing:{timeSignature:m,currentStep:s}}):r.a.createElement(f,{instruments:t}))}function p(){return r.a.createElement("nav",{className:"header"},r.a.createElement("div",{className:"title"},"Cofi"),r.a.createElement("div",{className:"toggle"},r.a.createElement("div",null,"Visualizer"),r.a.createElement("div",null,"Clear "),r.a.createElement("div",null,"Save")))}var g="128";function b(e){var t=e.bpmObj,n=e.stepObj,a=t.globalBPM,c=t.setGlobalBPM,i=t.inputBPM,o=t.setInputBPM,s=n.currentStep;return r.a.createElement("div",{className:"bpm-container"},r.a.createElement("div",{className:"bpm-control"},r.a.createElement("input",{id:"bpm-input",type:"text",pattern:"[0-9]*",onBlur:function(e){var t=e.target.value;t>50&&t<200?(c(t),o(t)):(c(a),o(a))},onChange:function(e){var t=e.target.validity.valid&&e.target.value.length<=3&&Number(e.target.value)<=200?e.target.value:String(g);o(t)},value:i})),s>=0&&r.a.createElement("div",{className:"beat-count"},"beat count: ",s+1))}function h(e){return r.a.createElement("div",{className:"transport-container"},r.a.createElement("div",{className:"transport"},r.a.createElement("div",{className:"rewind"},"<"),function(){var t=!0!==e.playing?{color:"red"}:{color:"black"},n=!0===e.playing?{color:"red"}:{color:"black"};return r.a.createElement("div",{className:"play-pause",onClick:e.togglePause},r.a.createElement("span",{className:"pause",style:t},"\u04cf\u04cf"),r.a.createElement("span",{className:"play",style:n},"\u25b6"))}(),r.a.createElement("div",{className:"stop"},"\u2591"),r.a.createElement("div",{className:"forward"},">")))}var E=n(6),O=n(7),j=function(){function e(t,n){return Object(E.a)(this,e),this.AC=t,this.freq=n,this.wave="sine",this.createNodes=this.createNodes.bind(this),this.setFreq=this.setFreq.bind(this),this.setWaveform=this.setWaveform.bind(this),this.setBaseValues=this.setBaseValues.bind(this),this.setBaseValues(this.wave,n,t)}return Object(O.a)(e,[{key:"createNodes",value:function(e){return{source:e.createOscillator()}}},{key:"setFreq",value:function(e,t){return e.source.frequency.value=t,e}},{key:"setWaveform",value:function(e,t){if(["sine","square","sawtooth","triangle"].includes(t))e.source.type=t;else if("custom"===t){var n=new Float32Array([0,1]),a=new Float32Array([0,0]),r=AudioContext.createPeriodicWave(n,a,{disableNormalization:!0});e.source.setPeriodicWave(r)}}},{key:"setBaseValues",value:function(e,t,n){var a=this.createNodes(n);return this.setFreq(a,t,n),this.setWaveform(a,e),a}}]),e}();var S=function(e,t,n,a,r,c){return t=function(e,t){var n=e.createGain();return n.gain.value=0,t.gain=n,t}(e,t),console.log("start tiem here and source: ",n,t),function(e,t){e.gain.gain.value=0,e.gain.gain.linearRampToValueAtTime(.8,t+.09)}(t,n),t.gain.gain.linearRampToValueAtTime(0,n+.2),t.source.start(n),t.source.stop(n+a),666!==t.source.frequency.value&&function(e,t){t.gain.connect(e.destination),t.source.connect(t.gain)}(e,t),t.source.onended=r,t},w=function(e,t,n,a,r){for(var c in r){if(r[c].pattern[t].activated){var i=new r[c].source(e,r[c].freq);console.log("my dource",i);r[c].pattern[t].automation;var o=60/a;console.log("in step: start tiem here",n,e.currentTime),S(e,i,n,o/2)}}},y=[];var N=new(window.AudioContext||window.webkitAudioContext),k=[];var T=function(){var e=Object(a.useState)("128"),t=Object(s.a)(e,2),n=t[0],c=t[1],i=Object(a.useState)(n),u=Object(s.a)(i,2),l=u[0],m=u[1],v=Object(a.useState)(-1),f=Object(s.a)(v,2),g=f[0],E=f[1],O=Object(a.useState)(16),T=Object(s.a)(O,2),q=T[0],B=(T[1],Object(a.useState)(4)),A=Object(s.a)(B,2),C=A[0],P=A[1],x=Object(a.useState)(function(e,t){var n={triggered:!1,activated:!1,automation:{}},a={kick:{source:j,context:e,freq:261.6},snare:{source:j,context:e,freq:400},hihat_open:{source:j,context:e,freq:350},hihat_closed:{source:j,context:e,freq:300},clap:{source:j,context:e,freq:250},rim:{source:j,context:e,freq:200},bell:{source:j,context:e,freq:180}};for(var r in a)a[r].pattern=new Array(t).fill(n);return a}(N,q)),I=Object(s.a)(x,2),M=I[0],V=I[1],W=Object(a.useState)(!0),F=Object(s.a)(W,2),R=F[0],G=F[1],z=Object(a.useState)(!1),J=Object(s.a)(z,2),_=J[0],D=J[1],$=Object(a.useState)(!1),H=Object(s.a)($,2),K=H[0],L=H[1],Q=Object(a.useState)(null),U=Object(s.a)(Q,2),X=U[0],Y=U[1],Z=Object(a.useState)([]),ee=Object(s.a)(Z,2),te=ee[0],ne=ee[1];function ae(){G(!R)}document.onkeypress=function(e){var t=e.key;document.activeElement===document.body?(e.preventDefault(),"p"===t&&ae()," "===t&&("suspended"===N.state&&!1===K&&(console.log("not initialized yet..."),oe(),L(!0)),ce(e)),"?"===t&&re(),","!==t&&"."!==t||ie(t)):"Escape"===t&&document.activeElement.blur()};var re=function(){E(-1),D(!1),N.close(),N=new(window.AudioContext||window.webkitAudioContext),L(!1)},ce=function(){D(!_)},ie=function(e){E(g+(","!==e||"."===e&&!0===e?1:-1))};function oe(){var e=se(!0);e.start(0),e.stop(.05)}function se(e){console.log("making note: time=",N.currentTime);var t=N.createOscillator(),n=N.createGain();return n.gain.value=0,n.gain.linearRampToValueAtTime(.1,N.currentTime+.09),n.gain.linearRampToValueAtTime(0,N.currentTime+.15),t.frequency.value=666,t.connect(n),n.connect(N.destination),!1===e&&N.currentTime>0&&E(g+1),t}return Object(a.useEffect)((function(){0===N.currentTime&&oe()}),[]),function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){function e(){n.current()}if(null!==t){e();var a=setInterval(e,t);return function(){return clearInterval(a)}}}),[t])}((function(){for(var e=2*X/1e3,t=60/n,a=N.currentTime,r=a+e,c=te.filter((function(e){return e>a&&e<=r&&!k.includes(e)&&a>.2})),i=0;i<c.length;i++){var s=c[i],u=se(!1);S(N,{source:u},s,t);var l=[].concat(Object(o.a)(k),[s]);l.length>Number(q)&&(l=l.slice(1)),k=l}(te[te.length-1]+t<r||N.currentTime>te[0])&&ne(te.map((function(e){return e+t})))}),X),Object(a.useEffect)((function(){if(_){var e=N.currentTime,t=Object(o.a)(Array(q-g).keys()).map((function(t){return e+t*(60/n)}));ne(t),"suspended"===N.state&&N.resume(),Y(15)}else"running"===N.state&&N.suspend(),Y(null)}),[_]),Object(a.useEffect)((function(){g>=q&&E(0),g>0&&g<q&&w(N,g,te[0],n,M),function(e,t){e.push(t);var n=0,a=[];e.forEach((function(t,n){if(n>0){var r=e[n+1]-t;a.push(r)}})),a.pop(),a.forEach((function(e){n+=e})),console.log("avg: ".concat(n/a.length),a)}(y,N.currentTime)}),[g]),r.a.createElement("div",{className:"App"},r.a.createElement(p,null),r.a.createElement(h,{togglePause:ce,playing:_}),r.a.createElement(b,{bpmObj:{globalBPM:n,setGlobalBPM:c,inputBPM:l,setInputBPM:m,handleTimeSignatureChange:function(e){P(e)}},stepObj:{totalSteps:q,currentStep:g}}),r.a.createElement(d,{instruments:M,setInstruments:V,timing:{globalBPM:n,currentStep:g,timeSignature:C},toggles:{handleSequencerToggle:ae,automationToggle:R}}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(T,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},9:function(e,t,n){e.exports=n(16)}},[[9,1,2]]]);
//# sourceMappingURL=main.8e894283.chunk.js.map